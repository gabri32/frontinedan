<!-- FORMULARIO DE USUARIO -->
<div class="container mt-4">
  <h3 class="mb-4 text-center">{{ editando ? 'Editar Usuario' : 'Registrar Usuario' }}</h3>

  <!-- NOMBRE -->
  <div class="mb-3">
    <label for="nombre" class="form-label">Nombre</label>
    <input type="text" class="form-control" id="nombre" [(ngModel)]="nombre" required />
  </div>

  <!-- CONTRASEÑA (solo al crear) -->
  <div class="mb-3" *ngIf="!editando">
    <label for="contrasena" class="form-label">Contraseña</label>
    <input type="password" class="form-control" id="contrasena" [(ngModel)]="contrasena" required />
  </div>

  <!-- CORREO -->
  <div class="mb-3">
    <label for="correo" class="form-label">Correo electrónico</label>
    <input type="email" class="form-control" id="correo" [(ngModel)]="correo" required />
  </div>

  <!-- NÚMERO DE IDENTIFICACIÓN -->
  <div class="mb-3">
    <label for="numIdentificacion" class="form-label">Número de identificación</label>
    <input type="text" class="form-control" id="numIdentificacion" [(ngModel)]="num_identificacion" required />
  </div>

  <!-- ROL -->
  <div class="mb-3">
    <label for="tipoUsuario" class="form-label">Tipo de usuario</label>
    <select class="form-select" id="tipoUsuario" [(ngModel)]="rol_id" required>
      <option value="" disabled>Seleccione un tipo</option>
      <option *ngFor="let type of roles" [value]="type.id">{{ type.nombre }}</option>
    </select>
  </div>

  <!-- SEDE -->
  <div class="mb-3">
    <label class="form-label">Sede</label>
    <select class="form-select" [(ngModel)]="sede">
      <option value="" disabled>Seleccione sede</option>
      <option *ngFor="let s of sedes" [value]="s.id">{{ s.detalle }}</option>
    </select>
  </div>

  <!-- CAMPOS SEGÚN ROL -->

  <!-- Estudiante -->
  <div *ngIf="rol_id == 2">
    <div class="mb-3">
      <label class="form-label">Edad</label>
      <input type="number" class="form-control" [(ngModel)]="edad" />
    </div>
    <div class="mb-3">
      <label class="form-label">Grado</label>
      <input type="text" class="form-control" [(ngModel)]="grado" />
    </div>
  </div>

  <!-- Profesor -->
  <div *ngIf="rol_id == 1">
    <div class="mb-3">
      <label class="form-label">Especialidad</label>
      <input type="text" class="form-control" [(ngModel)]="especialidad" />
    </div>
    <div class="mb-3">
      <label class="form-label">Vigencia</label>
      <select class="form-select" [(ngModel)]="vigencia">
        <option [ngValue]="true">Activo</option>
        <option [ngValue]="false">Inactivo</option>
      </select>
    </div>
  </div>

  <!-- BOTONES -->
  <div class="mt-3">
    <!-- Crear -->
    <button *ngIf="!editando" class="btn btn-success" (click)="guardarUsuario()">
      Crear Usuario
    </button>

    <!-- Editar -->
    <button *ngIf="editando" class="btn btn-primary" (click)="actualizarUsuario()">
      Actualizar Usuario
    </button>

    <!-- Cancelar edición -->
    <button *ngIf="editando" class="btn btn-secondary ms-2" (click)="cancelarEdicion()">
      Cancelar
    </button>
  </div>
</div>

<hr class="my-5" />

<!-- TABLA DE USUARIOS -->
<div class="container mt-4">
  <h3 class="mb-4 text-center">Lista de Usuarios</h3>

  <mat-form-field appearance="outline" class="w-100 mb-3">
    <mat-label>Buscar usuario</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Filtrar por nombre, correo o rol">
  </mat-form-field>

  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 w-100">

    <!-- Nombre -->
    <ng-container matColumnDef="nombre">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
      <td mat-cell *matCellDef="let user">{{ user.nombre }}</td>
    </ng-container>

    <!-- Correo -->
    <ng-container matColumnDef="correo">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Correo</th>
      <td mat-cell *matCellDef="let user">{{ user.correo }}</td>
    </ng-container>

    <!-- Identificación -->
    <ng-container matColumnDef="num_identificacion">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Identificación</th>
      <td mat-cell *matCellDef="let user">{{ user.num_identificacion }}</td>
    </ng-container>

    <!-- Rol -->
    <ng-container matColumnDef="rol">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Rol</th>
      <td mat-cell *matCellDef="let user">
        {{ user.rol_id == 1 ? 'Profesor' : user.rol_id == 2 ? 'Estudiante' : 'Administrador' }}
      </td>
    </ng-container>

    <!-- Acciones -->
    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let user">
        <button mat-raised-button color="accent" class="me-2" (click)="editarUsuario(user)">Editar</button>
        <button mat-raised-button color="warn" (click)="eliminarUsuario(user.id)">Eliminar</button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <mat-paginator [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons></mat-paginator>
</div>

